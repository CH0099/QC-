<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品條碼掃描器</title>
    <style>
        /* 之前的CSS保持不變 */
        .button-group {
            display: flex;
            justify-content: space-between;
        }
        .button-group button {
            flex: 1;
            margin: 0 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>商品條碼掃描器</h1>
        <input type="text" id="orderNumber" placeholder="輸入單號">
        <button onclick="setOrderNumber()">設置單號</button>
        <div id="currentOrderNumber"></div>
        <div id="lastScannedCode"></div>
        <div id="scanner"></div>
        <div id="scannedCodes"></div>
        <div class="button-group">
            <button onclick="completeOrder()">完成</button>
            <button onclick="undoLastScan()" style="background-color: #e74c3c;">取消上一個掃瞄內容</button>
            <button onclick="exitOrder()" style="background-color: #95a5a6;">退出單號</button>
        </div>
        <button onclick="generateCSV()" style="background-color: #27ae60;">生成CSV文件</button>
    </div>

    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        // 之前的JavaScript代碼保持不變

        function generateCSV() {
            if (!currentOrderNumber || scannedCodes.length === 0) {
                alert('沒有資料可以生成CSV');
                return;
            }

            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "單號,條碼\n";
            scannedCodes.forEach(code => {
                csvContent += `${currentOrderNumber},${code}\n`;
            });

            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `訂單_${currentOrderNumber}_掃描數據.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // HTML5QrcodeScanner 初始化代碼保持不變
    </script>
</body>
</html>
